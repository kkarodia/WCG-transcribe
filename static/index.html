<!DOCTYPE html>
<html>
<head>
    <title>Transcription App</title>
</head>
<body>
    <h1>Transcription App</h1>
    <button id="startTranscription">Start Transcription</button>
    <button id="stopTranscription">Stop Transcription</button>
    <div id="transcriptDisplay"></div>

    <script>
        const startButton = document.getElementById('startTranscription');
        const stopButton = document.getElementById('stopTranscription');
        const transcriptDisplay = document.getElementById('transcriptDisplay');
        let eventSource = null;

        startButton.addEventListener('click', () => {
            // Close any existing EventSource
            if (eventSource) {
                eventSource.close();
            }

            // Create new EventSource
            eventSource = new EventSource('/start_transcription');

            eventSource.onmessage = function(event) {
                transcriptDisplay.textContent += event.data + '\n';
            };

            eventSource.onerror = function(error) {
                console.error('EventSource failed:', error);
                eventSource.close();
            };
        });

        stopButton.addEventListener('click', () => {
            if (eventSource) {
                eventSource.close();
            }

            fetch('/stop_transcription')
                .then(response => response.json())
                .then(data => {
                    console.log(data.status);
                    fetch('/get_final_transcript')
                        .then(response => response.json())
                        .then(transcriptData => {
                            transcriptDisplay.textContent += '\nFinal Transcript:\n' + transcriptData.transcript;
                        });
                });
        });
    </script>
</body>
</html>
